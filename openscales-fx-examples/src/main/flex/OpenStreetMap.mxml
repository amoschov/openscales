<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:os="http://openscales.org" creationComplete="initMap();" >
	<mx:Script>
		<![CDATA[
			import org.openscales.core.handler.IHandler;
			import org.openscales.core.handler.mouse.DragHandler;
			import org.openscales.core.handler.mouse.WheelHandler;
			import mx.events.ResizeEvent;
			import org.openscales.core.Map;
			import org.openscales.core.popup.Popup;
			import org.openscales.core.control.MousePosition;
			import org.openscales.core.Marker;
			import org.openscales.core.feature.Feature;
			import org.openscales.core.layer.Markers;
			import org.openscales.core.control.PanZoom;
			import org.openscales.core.control.PanZoomBar;
			import org.openscales.core.basetypes.Bounds;
			import org.openscales.core.basetypes.LonLat;
			import org.openscales.core.basetypes.Size;
			import org.openscales.core.basetypes.Pixel;
			import org.openscales.core.control.LayerSwitcher;
			import org.openscales.core.layer.osm.OSM;
			import org.openscales.core.layer.osm.Maplint;
			import org.openscales.core.layer.osm.Mapnik;
			import org.openscales.core.layer.osm.Osmarender;
			
			public var map:Map; 
			
			public var feature:Feature; 
			
			//Lyon (France) EPSG:900913
			public static var lon:Number=538850.47459;
			public static var lat:Number=5740916.1243;
        	
        	public var mark:Marker;
        	public var markLyon:Marker;
			
			private function initMap():void
			{
				map = fxmap.map;
				
								
				//We configure the layer and the map to display EPSG:900913
				var mapnik:Mapnik = new Mapnik("Mapnik");
				mapnik.maxResolution = 156543.0339;
				mapnik.minResolution = 0.5971642833709717;
				mapnik.numZoomLevels = 20;
				mapnik.maxExtent = new Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34);
				mapnik.isBaseLayer = true;
				
				map.maxExtent = new Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34);
				map.maxResolution = 156543.0339;
				map.minResolution = 0.5971642833709717;
				map.numZoomLevels = 20;				
				
				map.addLayer(mapnik);
				
				//We create a marker over Lyon (France)
				var markers:Markers = new Markers("Markers");
				feature = new Feature(markers,new LonLat(lon,lat),{popupContentHTML:"This is a popup<br /><b>Bold text</b><br /><u>Link to <a href=\"http://openscales.org\" target=\"_new\">OpenScales</a></u>"});
				mark = feature.createMarker();
				
				markLyon = feature.createMarker();
				markLyon.addEventListener(MouseEvent.CLICK,showPopup);
				
				markers.addMarker(markLyon);
				
				mark.addEventListener(MouseEvent.CLICK, showPopup); 
				markers.addMarker(mark);
				map.addLayer(markers);
				
				//We center the map and zoom at the wanted level
				map.center = new LonLat(538850.47459,5740916.1243);
				map.zoom = 9;
			}
			
			private function showPopup(e:MouseEvent):void
			{				
				var pop:Popup = feature.createPopup();			
				map.addPopup(pop);
			}  
		]]>
	</mx:Script>
	
	<os:Map id="fxmap" width="100%" height="100%" >
		
		
		<os:PanZoomBar />
		<os:MousePosition />
		<os:LayerSwitcher />
		
		<os:DragHandler />
		<os:ClickHandler />
		<os:WheelHandler />
	</os:Map>
	
</mx:Canvas>
