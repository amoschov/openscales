<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:os="*"
	layout="horizontal"
	creationComplete="init();">
	
	<mx:Style>
		ToolTip {
			cornerRadius: 6;
			backgroundAlpha: 0.66;
			backgroundColor: #000000;
			color: #ffff66;
		}
		Panel {
			borderAlpha: 0.66;
			borderColor: #000000;
			color: #000000;
			titleStyleName: "PanelTitle";
		}
		.PanelTitle {
			color: #ffffff;
			letterSpacing: 1;
			fontWeight: bold;
			fontStyle: italic;
			/*text-indent: 24;*/
		}
	</mx:Style>
	
	<mx:Script>
		<![CDATA[
			import mx.core.Container;
			
			[Bindable] private var selectedNode:XML = null;
			private var selectedView:Container = null;
			private var oldSelectedIndex:int = 0;
            
			private function init():void {
				setOSdescription();
				expandTree();
			}
			
			private function setOSdescription():void {
				var text:String;
				text = "OpenScales.org 1.0 bêta - 09/14/2009";
				text += "\n\n\n";
				text += "OpenScales.org is a user-friendly and fast interface designed to manipulate spatial data : geographic raster viewing, data-vector editing, management of smooth transitions between scales and positions, ...";
				text += "\n\n";
				text += "As a free open source (LGPL license) and extensible tool written in ActionScript, OpenScales is designed to be easily plugged in your Flex or Air application. OpenScales is a small but powerful core of GIS, so try it and let us know.";
				text += "\n\n";
				text += "OpenScales.org can be considered as an ActionScript3 port of Openlayers, since it has started from FlexLayers soure code that we actively improve to take advantage of new capabilities offered by ActionScript3 and Flex technologies.";
				OSdescription.text = text;
			}
			
			private function expandTree():void {
				for(var i:int=0; i<tree.dataProvider.length; i++) {
					tree.expandChildrenOf(tree.dataProvider[i], true);
				}
			}
			
			private function collapseTree():void {
				for(var i:int=0; i<tree.dataProvider.length; i++) {
					tree.expandChildrenOf(tree.dataProvider[i], false);
				}
			}
			
			private function treeChanged(event:Event):void {
				selectedNode = Tree(event.target).selectedItem as XML;
				selectedView = viewStack.getChildByName(selectedNode.@viewStack) as Container;
				if (selectedView) {
					viewStack.selectedChild = selectedView;
					description.text = selectedNode.@description;
					oldSelectedIndex = tree.selectedIndex;
				} else {
					var open:Boolean = false; // FixMe: get the current state
					tree.expandChildrenOf(tree.selectedItem, ! open);
					tree.selectedIndex = oldSelectedIndex;
				}
			}
		]]>
	</mx:Script>
	
	<mx:Tree id="tree" width="230" height="100%" labelField="@label" showRoot="true" change="treeChanged(event)">
		<mx:XMLListCollection>
			<mx:XMLList id="treeData">
				<example viewStack="home" label="What is OpenScales.org" description="A short description of OpenScales.org" />
				
				<!--example viewStack="global" label="Global" description="" /-->
				
				<category label="Configure the map">
					<example viewStack="panZoom" label="Pan &amp; zoom" description="The map displayed is OpenStreetMap Mapnik (EPSG:900913).\nMove the map using drag or N/S/E/W buttons.\nZoom in/out using the mouse wheel, the scale slider, the +/- buttons above and below the slider or the zoom-box button.\nThe coordinates of the mouse cursor are displayed as LongLat." />
					<example viewStack="layersManager" label="Manage the layers" description="Choose a base layer using the combo-box.\nChange the order of the overlays using the up/down buttons or draging an overlay.\nSet the opacity of each layer (base layer or overlay) using its slider." />
				</category>
				
				<category label="Manage features">
					<example viewStack="drawings" label="Draw features" description="Drag the map or draw some points, polylines or polygons using the buttons of the first line.\nUse click and CTRL+click to select features.\nUse the buttons of the second line to remove the last drawn vertex, to delete the selected features, to delete all the drawn features or to merge the selected features." />
					<example viewStack="features" label="Use all the types of features" description="This is an example of each type of geometry: point (red), multipoint (orange), line (green), multiline (red), polygon (blue), multipolygon (violet).The additional black geometries are used to test the 'containsPoint' and 'intersects' functions of each geometry.Select one geometry by a click or several geometries using the selectBox button and drawing a box.Use CTRL+click and CTRL+selectBox to define a complex selection." />
					<example viewStack="informations" label="Get information on the features" description="Click on a point to see its attributes in the panel." />
					<example viewStack="reprojectionAndQuery" label="Reproject and query" description="" />
				</category>
				
				<category label="Localize">
					<example viewStack="overview" label="Overview" description="Use the miniMap to move and zoom" />
					<example viewStack="search" label="Yahoo Search" description="Search a place with Yahoo" />
				</category>
				
				<category label="Protocols">
					<example viewStack="capabilities" label="Capabilities" description="Add a WFS which is on a server" />
					<example viewStack="wmsc1" label="Metacarta WMS-C" description="" />
					<example viewStack="wmsc2" label="WMS-C layer and 2 WFS" description="" />
					<example viewStack="polygons" label="Metacarta WFS Polygons" description="" />
					<example viewStack="points" label="Metacarta WFS Points" description="" />
					<example viewStack="wms" label="Germany WMS" description="" />
				</category>
				
				<category label="Security">
					<example viewStack="security" label="Security" description="IGN GeoDRM: not implement yet" />
				</category>
			</mx:XMLList>
		</mx:XMLListCollection>
	</mx:Tree>
	
	<mx:VBox width="100%" height="100%">
		<mx:ViewStack id="viewStack" width="100%" height="100%">
			<mx:Panel id="home" title="OpenScales.org 1.0 bêta - september 14th 2009">
				<!-- also needed because the view of index 0 is always loaded first -->
				<mx:VBox horizontalAlign="center" width="100%" height="100%">
					<mx:Image />
					<mx:TextArea id="OSdescription" width="100%" height="100%" />
				</mx:VBox>
			</mx:Panel>
			
			<!--os:Global id="global" /-->
			
			<!-- Configure the map -->
			<os:PanZoom id="panZoom"  />		
			<os:LayerSwitcher id="layersManager" />
			
			<!-- Manage features -->
			<os:DrawingExample id="drawings" />
			<os:FeaturesExample id="features" />
			<os:InfoExample id="informations" />
			<os:OpenStreetMap id="reprojectionAndQuery" />
			
			<!-- Localize -->
			<os:OverView id="overview" />
			<os:YahooSearchExample id="search" />			
			
			<!-- Protocols -->
			<os:CapabilitiesExample id="capabilities" />
			<os:MetacartaWMSC id="wmsc1" />
			<os:GeovistaWMSCWFS id="wmsc2" />
			<os:MetacartaWFSPolygons id="polygons" />
			<os:MetacartaWFSPoints id="points"/>
			<os:GermanyWMS id="wms" />
			
			<!-- Security -->
			<os:SecurityMap id="security" />
		</mx:ViewStack>
		<mx:TextArea id="description" width="100%" height="100" />
	</mx:VBox>
	
</mx:Application>
