<?xml version="1.0" encoding="utf-8"?>
<control:Control xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:control="org.openscales.component.control.*" implements="org.openscales.core.control.IControl" width="244" height="158">
	
	<mx:Script>
		<![CDATA[
			import org.openscales.core.handler.sketch.DrawPolygonHandler;
			import org.openscales.core.handler.sketch.DrawPathHandler;
			import mx.controls.Alert;
			import org.openscales.core.layer.Vector;
			import org.openscales.core.handler.Handler;
			import org.openscales.core.handler.sketch.DrawPointHandler;
			import org.openscales.core.geometry.Geometry;
			
			import org.openscales.core.Map;
			
			
			public var drawLayer:Vector = new Vector("Sketch");			
			public var pointHandler:DrawPointHandler = new DrawPointHandler(null, false, drawLayer);
			public var polygonHandler:DrawPolygonHandler = new DrawPolygonHandler(null, false, drawLayer);
			public var pathHandler:DrawPathHandler = new DrawPathHandler(null,false,drawLayer);
			
			
			private var drawType:String = "";
			

			public function onDeleteAllClick(event:Event):void {
				drawLayer.destroyFeatures();
				drawLayer.renderer.clear();
				
				switch(drawType)
				{
					case "path":{pathHandler.points = null; break;}
					case "polygon":{polygonHandler.firstCall = true; break;}
				}
			}
			
			public function onDeleteLastClick(event:Event):void {
				var last:Number = drawLayer.features.length - 1;
				
				if (last >= 0) {
					
					switch(drawType)
					{
						case "path":		
							drawLayer.removeFeatures(drawLayer.features[last]);					
							pathHandler.points[last+1]=null;
							pathHandler.id--;	
							break;						
						case "polygon":
							Alert.show("Not implemented yet...", "Message");
							break;
						case "point":
							drawLayer.removeFeatures(drawLayer.features[last]);
							break;
					}   
				}
				else {
					Alert.show("There are not features to delete !", "Message");
				}
			}
			public function onPathClick(event:Event):void {			
				if(drawType != "path"){
					drawType = "path";
					pathHandler.active = true;
					
					btnPoint.enabled = false;
					btnPolygon.enabled = false;
				}
				else {
					drawType = "";
					pathHandler.active = false;
					btnPoint.enabled = true;
					btnPolygon.enabled = true;
				}
			}
			
			public function onPolygonClick(event:Event):void {
				if(drawType != "polygon") {
					drawType = "polygon"
					
					polygonHandler.active = true;
					
					btnPath.enabled = false;
					btnPoint.enabled = false;
				}
				else {
					drawType = "";
					polygonHandler.active = false;
					
					btnPath.enabled = true;
					btnPoint.enabled = true;
				}
			}
			
			public function onPointClick(event:Event):void {
				if(drawType != "point") {
					drawType = "point";
					pointHandler.active = true;
					
					btnPath.enabled = false;
					btnPolygon.enabled = false;
				}
				else {
					drawType = "";
					pointHandler.active = false;
					
					btnPath.enabled = true;
					btnPolygon.enabled = true;
				}
			}
			
			override public function set map(value:Map):void
			{
				super.map = value;
				
				if (this.map != null) {
					pointHandler.map = this.map;
					pathHandler.map = this.map;
					polygonHandler.map = this.map
					this.map.addLayer(drawLayer);
				}
				
			}
		]]>
	</mx:Script>
	<mx:Button x="10" y="10" label="Point" id="btnPoint" click="this.onPointClick(event)" toggle="true" width="72"/>
	<mx:Button x="146" y="69" label="DeleteAll" id="btnDeleteAll" click="this.onDeleteAllClick(event)" width="88"/>
	<mx:Button x="10" y="69" label="Path" id="btnPath" width="72" click="this.onPathClick(event)" toggle="true"/>
	<mx:Button x="10" y="124" label="Polygon" id="btnPolygon" click="this.onPolygonClick(event)" toggle="true"/>
	<mx:Button x="146" y="10" label="DeleteLast" width="88" id="btnDeleteLast" click="this.onDeleteLastClick(event)"/>
	

</control:Control>